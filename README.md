# ImageBook Microservices

This repository contains links and documentation for the ImageBook project's microservices.

## Microservices

- [ImageBook Client](https://github.com/EgSundqvist/imagebook-client): Frontend application built with React and TypeScript.
- [ImageBook User API](https://github.com/EgSundqvist/imagebook-userapi): API for user management, built with Python.
- [ImageBook Image API](https://github.com/EgSundqvist/imagebook-imageapi): API for image management, built with Go.

## Documentation

### Example of application flow

![Example of application flow](https://github.com/EgSundqvist/imagebook/blob/main/ImagebookMicroservicesFlow.png)

### CI/CD and cluster flow

![CI/CD and cluster flow](https://github.com/EgSundqvist/imagebook/blob/main/ImagebookClusterFlow.png)

## Purpose

The purpose of this project has been to build an application according to Cloud Native principles. This concept includes:
- Logic and functionality divided into small microservices instead of larger APIs and services.
- Container technology such as Docker to package and isolate applications and services, optimizing hardware performance.
- Orchestration with tools such as Kubernetes for distributing and scaling container-based applications.
- CI/CD for continuous integration and delivery, automating workflows and processes in development such as CodeBuild.

Additionally, my aim was to develop my knowledge in two previously unfamiliar languages commonly used for building microservices: Go and Python.

## Description and Use

Imagebook is a web application intended as a private photo album. Currently, users can register, log in, manage accounts and profiles, upload and delete images, and view their uploaded images in an infinite scroll. There are plans to expand the application with more social and interactive functionalities, such as interacting with other users and viewing their resources.

## Client - React

The client, built with React, provides a clean and logical interface for managing images and user profile information. React Router is used for routing, providing a clear navigation experience with SPA (Single Page Application) behavior. It also distinguishes between public and protected pages based on user authentication.

JSON Web Tokens generated by the User API upon login are used for authenticated requests. Tokens are stored in LocalStorage and managed with Redux to maintain global state across the application and handle authentication status. The application uses a timer to track token validity and automatically logs the user out when the token expires.

TanStack Query is used to display the user's images in an infinite scroll with caching functionalities. MUI provides functional components that are further customized to fit the application. A clear and consistent project structure is maintained through naming conventions, separating code into components, hooks, and pages to keep file sizes manageable and facilitate code reuse.

## ImageAPI - Go

This API, written in Go, handles images via requests from the client and the User API. It uses libraries such as GORM, Gin, and AWS SDK, following a repository pattern for database methods. SQLite is used for development, and MySQL for production. Environment variables and AWS Parameter Store manage differing parameters and protect secret keys.

Endpoints include uploading, deleting, and retrieving images in pages, and creating new folders in the S3 bucket based on user IDs. Images are stored in an AWS S3 bucket, with metadata saved in the database. Integration with AWS S3 is central, using the AWS SDK to establish sessions. Handlers for S3 traffic have endpoints like /upload-url and /confirm-upload for handling image uploads.

## UserAPI - Python

This API, built with Python, handles user management, profiles, login, and registration. It uses libraries such as Flask, Werkzeug Security (password hashing), and SQLAlchemy. SQLite is used for development, and MySQL for production, managed through environment variables.

A key function is the login endpoint, generating JWTs with user ID and token validity, ensuring secure access to user resources. Communication between the User API and Image API includes creating new user folders in AWS S3 upon registration, with secure token management to prevent endpoint misuse.

## CI/CD

All services are published to GitHub repositories with AWS CodeBuild listening for changes, building images, and pushing them to a private Git server in the cluster. Kubernetes uses these images to deploy the application through pods (containers).

## Kubernetes

The Kubernetes cluster uses a node balancer to distribute incoming traffic, optimize resource usage, and ensure data persistence with PVC. Cert-manager handles HTTPS certificates, and Ingress manages external access. Keys and parameters are stored in Kubernetes secrets, base64-encoded. Linode's interface and Keel are used for managing pods and applications, with Keel controlling polling behaviors against the image registry.

## Future Functionality

Currently an MVP (Minimum Viable Product), planned future functionalities include:
- Tests
- Database backup
- Interactive features for users to search and interact with others and view their resources
- Rate-limiting
- Email server for authentication and password recovery
- Input validation
- Image optimization

## Lessons Learned

This project has been incredibly educational. Key takeaways include:
- Strategic logging is crucial, especially in Kubernetes environments where debugging access is limited.
- Breaking code into smaller components improves readability, understanding, and maintenance.
- Using environment variables for differing local and Kubernetes parameters allows for smooth transitions without constant changes.
